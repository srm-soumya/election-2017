"use strict";function drawforce(){function t(t){m.style("fill",function(t){return f[t.choice].color}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}function e(){var t=p.shift();y[b].cx=f[t].x,y[b].cy=f[t].y,y[b].choice=t,b++,h.force("cluster",d3.forceCluster().centers(function(t){return f[t.choice]}).strength(1).centerInertia(1)),h.alphaTarget(.15).restart(),p.length&&(v=setTimeout(e,.5))}function r(t){d3.selectAll(".agency").classed("active",!1);var r=d3.select(this).classed("active",!0).attr("id"),n=opinion_data[r];console.log("agency",n);var a=n[l[0]];a.party=l[0],l.forEach(function(t){n[t].seats>a.seats&&(a=n[t],a.party=t)}),d3.selectAll(".party-label").classed("winner",!1),d3.select("."+a.party).classed("winner",!0),x.attr("opacity",0).transition().duration(2e3).delay(1500).attr("opacity",1).text(function(t){return n[t].range}).attr("fill","#444"),g.attr("fill","#222"),b=0,d3.values(n).forEach(function(t,e){p.push.apply(p,Array(t.seats).fill(l[e]))}),v=setTimeout(e,10)}d3.select(".opinion-poll-svg").remove(),d3.selectAll("button.agency").remove();var n={top:20,right:0,bottom:0,left:20},a=1e3-n.left-n.right,o=250-n.top-n.bottom,c=d3.select("#opinion-polls").append("svg").classed("opinion-poll-svg",!0).attr("width",a+n.left+n.right).attr("height",o+n.top+n.bottom).attr("viewBox","0 0 "+(a+n.left+n.right)+" "+(o+n.top+n.bottom)).append("g").attr("transform","translate("+n.left+", "+n.top+")"),i=d3.keys(opinion_data),l=(d3.select("#agency-list").selectAll("button.agency").data(i).enter().append("button").classed("agency",!0).attr("id",function(t){return t}).html(function(t){return t}).on("click",r),d3.keys(opinion_data[i[0]])),s=d3.scalePoint().domain(l).range([0,a]).padding(.5),d=.8,u=num_constituency,f={center:{x:a/2,y:o/2,color:"#555"}};l.forEach(function(t){f[t]={x:s(t),y:o/2,color:color(t)}});var p=[],y=d3.range(0,u).map(function(t,e){return{id:"node"+e,x:f.center.x+Math.random(),y:f.center.y+Math.random(),radius:node_radius,choice:"center"}}),h=d3.forceSimulation().force("cluster",d3.forceCluster().centers(function(t){return f[t.choice]}).strength(1).centerInertia(1)).force("collide",d3.forceCollide(function(t){return t.radius+d})).on("tick",t).nodes(y),g=c.selectAll("text.party-label").data(l).enter().append("text").attr("class",function(t){return t}).classed("party-label",!0).attr("x",function(t){return s(t)}).attr("y",15).attr("text-anchor","middle").attr("fill","#ddd").text(function(t){return t});d3.selectAll("circle.node").remove();var x=c.selectAll("text.seat-label").data(l).enter().append("text").classed("seat-label",!0).attr("x",function(t){return s(t)}).attr("y",40).attr("text-anchor","middle").attr("fill","#fff"),m=c.selectAll("circle").data(y).enter().append("circle").attr("id",function(t){return t.id}).classed("node",!0).style("fill",function(t){return f[t.choice].color});m.transition().duration(1e3).delay(function(t,e){return 5*e}).attrTween("r",function(t){var e=d3.interpolate(2,t.radius);return function(r){return t.radius=e(r)}});var v,b=0}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function drawbars(){d3.selectAll("div.chart").remove();var t=previous_data.map(function(t){return t.wins}).reduce(function(t,e){return t+e},0)/3,e=d3.nest().key(function(t){return t.year}).entries(previous_data),r=160,n=130,a={top:20,right:10,bottom:30,left:30},o=d3.select("#previous-results").selectAll("div.chart").data(e).enter().append("div").classed("chart",!0),c=o.append("svg").attr("width",r+a.left+a.right).attr("height",n+a.top+a.bottom).append("g").attr("transform","translate("+a.left+", "+a.top+")"),i=(c.append("text").classed("year-label",!0).attr("text-anchor","middle").attr("x",r/2).attr("y",-7).text(function(t){return t.key}),[].concat(_toConsumableArray(new Set(previous_data.map(function(t){return t.party}))))),l=d3.scaleBand().domain(i).range([0,r]).padding(.1),s=d3.scaleLinear().domain([0,t]).range([n,0]),d=d3.axisBottom(l),u=d3.axisLeft(s).ticks(4).tickSize(-r);c.append("g").classed("axis",!0).classed("x-axis",!0).attr("transform","translate(0, "+n+")").call(d),c.append("g").classed("axis",!0).classed("y-axis",!0).call(u);c.selectAll("rect.bar").data(function(t){return t.values}).enter().append("rect").attr("x",function(t){return l(t.party)}).attr("width",l.bandwidth()).attr("y",function(t){return s(t.wins)}).attr("height",function(t){return n-s(t.wins)}).attr("fill",function(t){return color(t.party)}),c.selectAll("text.bar-label").data(function(t){return t.values}).enter().append("text").attr("x",function(t){return l(t.party)+l.bandwidth()/2}).attr("y",function(t){return s(t.wins)}).attr("text-anchor","middle").attr("dy","-0.35rem").text(function(t){return t.wins})}